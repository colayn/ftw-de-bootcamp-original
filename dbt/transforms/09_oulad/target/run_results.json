{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.9", "generated_at": "2025-10-06T15:39:45.476850Z", "invocation_id": "49ee5824-c2c7-4cba-80cc-a39a880fb754", "env": {}}, "results": [{"status": "error", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:37.446856Z", "completed_at": "2025-10-06T15:39:37.499517Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:37.637260Z", "completed_at": "2025-10-06T15:39:40.158747Z"}], "thread_id": "Thread-4", "execution_time": 2.8885903358459473, "adapter_response": {}, "message": "Database Error in model grp5_dq_oulad_student_registration_summary (models/mart/dq/grp5_dq_oulad_student_registration_summary.sql)\n  HTTPDriver for http://54.87.106.52:8123 received ClickHouse error code 62\n   Code: 62. DB::Exception: Syntax error: failed at position 2052 (end of query) (line 65, col 21): ;\n      \n    )\n        \n        \n                      -- end_of_sql\n                      \n                      . Expected one of: token, Dot, OpeningRoundBracket, UUID, alias, AS, identifier, FINAL, SAMPLE, table, table function, subquery or list of joined tables, array join, LEFT ARRAY JOIN, INNER, ARRAY JOIN, JOIN, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. (SYNTAX_ERROR) (version 23.12.6.19 (official build))\n  compiled code at target/run/ex_09_oulad/models/mart/dq/grp5_dq_oulad_student_registration_summary.sql", "failures": null, "unique_id": "model.ex_09_oulad.grp5_dq_oulad_student_registration_summary", "compiled": true, "compiled_code": "\n\n-- Inputs:\n--   raw table:   raw.grp5_oulad___student_registration\n--   clean table: clean.grp5_stg_oulad_student_registration\n\nwith src as (\n    select *\n    from `raw`.`grp5_oulad___student_registration`\n),\n\ncln as (\n    select *\n    from `clean`.`grp5_stg_oulad_student_registration`\n),\n\ncounts as (\n    select\n        (select count() from src) as row_count_raw,\n        (select count() from cln) as row_count_clean\n),\n\nnulls as (\n    select\n        round(100.0 * countIf(code_module is null) / nullif(count(),0), 2) as pct_null_code_module,\n        round(100.0 * countIf(code_presentation is null) / nullif(count(),0), 2) as pct_null_code_presentation,\n        round(100.0 * countIf(id_student is null) / nullif(count(),0), 2) as pct_null_id_student,\n        round(100.0 * countIf(date_registration is null) / nullif(count(),0), 2) as pct_null_date_registration,\n        round(100.0 * countIf(date_unregistration is null) / nullif(count(),0), 2) as pct_null_date_unregistration\n    from cln\n),\n\ndomains as (\n    select\n        countIf(code_module not in ('AAA','BBB','CCC','DDD','EEE','FFF','GGG')) as invalid_code_module,\n        countIf(code_presentation not in ('2013B','2013J','2014B','2014J')) as invalid_code_presentation\n    from cln\n),\n\njoined as (\n    select\n        counts.row_count_raw,\n        counts.row_count_clean,\n        (counts.row_count_raw - counts.row_count_clean) as dropped_rows,\n        nulls.pct_null_code_module,\n        nulls.pct_null_code_presentation,\n        nulls.pct_null_id_student,\n        nulls.pct_null_date_registration,\n        nulls.pct_null_date_unregistration,\n        domains.invalid_code_module,\n        domains.invalid_code_presentation\n    from counts\n    cross join nulls\n    cross join domains\n)\n\nselect * from joined;", "relation_name": "`mart`.`grp5_dq_oulad_student_registration_summary`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:37.433779Z", "completed_at": "2025-10-06T15:39:37.482506Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:37.493548Z", "completed_at": "2025-10-06T15:39:42.317658Z"}], "thread_id": "Thread-3", "execution_time": 4.9545207023620605, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_dq_oulad_student_registration_anomalies", "compiled": true, "compiled_code": "\n\n-- Row-level drilldown of \"obviously wrong\" records based on simple rules.\n-- LIMIT for demo-friendliness; remove in real pipelines.\n\nwith cln as (\n  select * from `clean`.`grp5_stg_oulad_student_registration`\n),\nviolations as (\n  select\n    -- NOTE: this dataset has no native PK; include a synthetic row_number if needed.\n    -- ClickHouse: use monotonicallyIncreasingId() isn't stable; we'll show columns directly.\n    code_module, code_presentation, id_student, date_registration, date_unregistration,\n\n    multiIf(\n      code_module not in ('AAA','BBB','CCC','DDD','EEE','FFF','GGG'),  'invalid_code_module',\n      code_presentation not in ('2013B', '2013J', '2014B', '2014J'), 'invalid_code_presentation',\n      'ok'\n    ) as dq_issue\n  from cln\n)\nselect *\nfrom violations\nwhere dq_issue != 'ok'\nlimit 50", "relation_name": "`mart`.`grp5_dq_oulad_student_registration_anomalies`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:37.416171Z", "completed_at": "2025-10-06T15:39:37.485246Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:37.551585Z", "completed_at": "2025-10-06T15:39:42.523139Z"}], "thread_id": "Thread-2", "execution_time": 5.181895732879639, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_dq_oulad_studentVle_anomalies", "compiled": true, "compiled_code": "\n\nwith cln as (\n    select * from `clean`.`grp5_stg_oulad_studentVle`\n),\n\nviolations as (\n    select\n        code_module,\n        code_presentation,\n        id_student,\n        id_site,\n        date,\n        sum_click,\n\n        multiIf(\n            id_student is null,                 'null_id_student',\n            sum_click is null,                  'null_sum_click',\n            NOT (\n                (code_module='AAA' AND code_presentation='2013J') OR\n                (code_module='AAA' AND code_presentation='2014J') OR\n                (code_module='BBB' AND code_presentation='2013J') OR\n                (code_module='BBB' AND code_presentation='2014J') OR\n                (code_module='BBB' AND code_presentation='2013B') OR\n                (code_module='BBB' AND code_presentation='2014B') OR\n                (code_module='CCC' AND code_presentation='2014J') OR\n                (code_module='CCC' AND code_presentation='2014B') OR\n                (code_module='DDD' AND code_presentation='2013J') OR\n                (code_module='DDD' AND code_presentation='2014J') OR\n                (code_module='DDD' AND code_presentation='2013B') OR\n                (code_module='DDD' AND code_presentation='2014B') OR\n                (code_module='EEE' AND code_presentation='2013J') OR\n                (code_module='EEE' AND code_presentation='2014J') OR\n                (code_module='EEE' AND code_presentation='2014B') OR\n                (code_module='FFF' AND code_presentation='2013J') OR\n                (code_module='FFF' AND code_presentation='2014J') OR\n                (code_module='FFF' AND code_presentation='2013B') OR\n                (code_module='FFF' AND code_presentation='2014B') OR\n                (code_module='GGG' AND code_presentation='2013J') OR\n                (code_module='GGG' AND code_presentation='2014J') OR\n                (code_module='GGG' AND code_presentation='2014B')\n            ), 'invalid_module_presentation',\n            'ok'\n        ) as dq_issue\n    from cln\n)\n\nselect *\nfrom violations\nwhere dq_issue != 'ok'", "relation_name": "`mart`.`grp5_dq_oulad_studentVle_anomalies`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:37.349794Z", "completed_at": "2025-10-06T15:39:37.457833Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:37.464749Z", "completed_at": "2025-10-06T15:39:42.569296Z"}], "thread_id": "Thread-1", "execution_time": 5.250750541687012, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_dq_oulad_studenVle_summary", "compiled": true, "compiled_code": "\n\nwith src as (\n    select * from `raw`.`studentVle`\n),\ncln as (\n    select * from `clean`.`grp5_stg_oulad_studentVle`\n),\n\ncounts as (\n    select\n        (select count() from src) as row_count_raw,\n        (select count() from cln) as row_count_clean\n),\n\nnulls as (\n    select\n        round(100.0 * countIf(id_student is null) / nullIf(count(),0),2) as pct_null_id_student,\n        round(100.0 * countIf(sum_click is null) / nullIf(count(),0),2) as pct_null_sum_click\n    from cln\n),\n\ndomains as (\n    select\n        countIf(\n            NOT (\n                (code_module='AAA' AND code_presentation='2013J') OR\n                (code_module='AAA' AND code_presentation='2014J') OR\n                (code_module='BBB' AND code_presentation='2013J') OR\n                (code_module='BBB' AND code_presentation='2014J') OR\n                (code_module='BBB' AND code_presentation='2013B') OR\n                (code_module='BBB' AND code_presentation='2014B') OR\n                (code_module='CCC' AND code_presentation='2014J') OR\n                (code_module='CCC' AND code_presentation='2014B') OR\n                (code_module='DDD' AND code_presentation='2013J') OR\n                (code_module='DDD' AND code_presentation='2014J') OR\n                (code_module='DDD' AND code_presentation='2013B') OR\n                (code_module='DDD' AND code_presentation='2014B') OR\n                (code_module='EEE' AND code_presentation='2013J') OR\n                (code_module='EEE' AND code_presentation='2014J') OR\n                (code_module='EEE' AND code_presentation='2014B') OR\n                (code_module='FFF' AND code_presentation='2013J') OR\n                (code_module='FFF' AND code_presentation='2014J') OR\n                (code_module='FFF' AND code_presentation='2013B') OR\n                (code_module='FFF' AND code_presentation='2014B') OR\n                (code_module='GGG' AND code_presentation='2013J') OR\n                (code_module='GGG' AND code_presentation='2014J') OR\n                (code_module='GGG' AND code_presentation='2014B')\n            )\n        ) as invalid_module_presentation\n    from cln\n),\n\njoined as (\n    select\n        counts.row_count_raw,\n        counts.row_count_clean,\n        (counts.row_count_raw - counts.row_count_clean) as dropped_rows,\n        nulls.pct_null_id_student,\n        nulls.pct_null_sum_click,\n        domains.invalid_module_presentation\n    from counts\n    cross join nulls\n    cross join domains\n)\n\nselect * from joined", "relation_name": "`mart`.`grp5_dq_oulad_studenVle_summary`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:40.288250Z", "completed_at": "2025-10-06T15:39:40.307865Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:40.309936Z", "completed_at": "2025-10-06T15:39:42.809250Z"}], "thread_id": "Thread-4", "execution_time": 2.5266473293304443, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_oulad_dim_courses", "compiled": true, "compiled_code": "\n\nselect\n    concat(cast(code_module as Nullable(String)), cast(code_presentation as Nullable(String))) \n        as id_course,\n    cast(code_module as Nullable(String))                           as code_module,\n    cast(code_presentation as Nullable(String))                     as code_presentation,\n    cast(module_presentation_length as Nullable(Int32))             as module_presentation_length\nfrom `clean`.`grp5_stg_oulad_courses`", "relation_name": "`mart`.`grp5_oulad_dim_courses`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:42.545010Z", "completed_at": "2025-10-06T15:39:42.574589Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:42.580012Z", "completed_at": "2025-10-06T15:39:44.830252Z"}], "thread_id": "Thread-2", "execution_time": 2.2910077571868896, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_oulad_dim_student", "compiled": true, "compiled_code": "\n\n-- Dimension table for students (no surrogate key)\nselect\n    cast(id_student as Int64)               as id_student,\n    cast(gender as Nullable(String))        as gender,\n    cast(age_band as Nullable(String))      as age_band,\n    cast(region as Nullable(String))        as region,\n    cast(highest_education as Nullable(String)) as highest_education,\n    cast(imd_band as Nullable(String))      as imd_band,\n    cast(disability as Nullable(String))    as disability\nfrom `clean`.`grp5_stg_oulad_student_info`", "relation_name": "`sandbox`.`grp5_oulad_dim_student`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:42.349266Z", "completed_at": "2025-10-06T15:39:42.372669Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:42.374557Z", "completed_at": "2025-10-06T15:39:44.848507Z"}], "thread_id": "Thread-3", "execution_time": 2.5078024864196777, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_oulad_dim_module_presentation", "compiled": true, "compiled_code": "\n\n-- Dimension table for module + presentation (simple, with Nullable types)\nselect\n    cast(code_module as Nullable(String))                           as code_module,\n    cast(code_presentation as Nullable(String))                     as code_presentation,\n    cast(module_presentation_length as Nullable(Int32))             as length_days\nfrom `clean`.`grp5_stg_oulad_courses`", "relation_name": "`sandbox`.`grp5_oulad_dim_module_presentation`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:42.618135Z", "completed_at": "2025-10-06T15:39:42.633798Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:42.635299Z", "completed_at": "2025-10-06T15:39:45.115146Z"}], "thread_id": "Thread-1", "execution_time": 2.5083906650543213, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_stg_oulad_student_assessment", "compiled": true, "compiled_code": " \n\n-- Standardize names and types for student assessment\nselect\n  cast(id_assessment  as Nullable(Int64)) as assessment_id,\n  cast(id_student     as Nullable(Int64)) as student_id,\n  cast(date_submitted as Nullable(Int64)) as date_submitted,\n  cast(is_banked      as Nullable(Int64)) as is_banked,\n  cast(score          as Nullable(Int64)) as score\nfrom `raw`.`grp5_oulad___student_assessment`", "relation_name": "`clean`.`grp5_stg_oulad_student_assessment`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T15:39:42.851100Z", "completed_at": "2025-10-06T15:39:42.868415Z"}, {"name": "execute", "started_at": "2025-10-06T15:39:42.869937Z", "completed_at": "2025-10-06T15:39:45.422726Z"}], "thread_id": "Thread-4", "execution_time": 2.5755794048309326, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.ex_09_oulad.grp5_stg_oulad_student_info", "compiled": true, "compiled_code": "\nselect\n  cast(code_module            as String)     as code_module,\n  cast(code_presentation      as String)     as code_presentation,\n  cast(id_student             as Int64)      as id_student,\n  cast(\n    case\n      when gender IN ('M', 'F') then gender\n      else 'Unknown'\n    end as String) as gender,\n  cast(region                 as String)     as region,\n  cast(highest_education      as String)     as highest_education,\n  cast(\n    case\n        when imd_band = '?' then null\n        when imd_band not like '%\\%%' then concat(imd_band, '%')\n        else imd_band\n    end as Nullable(String)) as imd_band,\n  cast(age_band               as String)     as age_band,\n  cast(num_of_prev_attempts   as Int64)      as num_of_prev_attempts,\n  cast(studied_credits        as Int64)      as studied_credits,\n  cast(disability             as String)     as disability,\n  cast(final_result           as String)     as final_result\nfrom `raw`.`grp5_oulad___student_info`", "relation_name": "`clean`.`grp5_stg_oulad_student_info`"}], "elapsed_time": 19.322771549224854, "args": {"which": "build", "strict_mode": false, "log_path": "/workdir/transforms/09_oulad/logs", "printer_width": 80, "quiet": false, "log_level": "info", "exclude_resource_types": [], "static_parser": true, "write_json": true, "log_format_file": "debug", "include_saved_query": false, "resource_types": [], "select": [], "use_colors_file": true, "log_level_file": "debug", "enable_legacy_logger": false, "target": "remote", "log_file_max_bytes": 10485760, "show_resource_report": false, "warn_error_options": {"include": [], "exclude": []}, "use_colors": true, "empty": false, "log_format": "default", "cache_selected_only": false, "export_saved_queries": false, "defer": false, "introspect": true, "show": false, "populate_cache": true, "project_dir": "/workdir/transforms/09_oulad", "partial_parse_file_diff": true, "profiles_dir": ".", "source_freshness_run_project_hooks": false, "indirect_selection": "eager", "favor_state": false, "require_resource_names_without_spaces": false, "print": true, "require_explicit_package_overrides_for_builtin_materializations": true, "partial_parse": true, "macro_debugging": false, "exclude": [], "vars": {}, "version_check": true, "send_anonymous_usage_stats": true, "invocation_command": "dbt build --profiles-dir . --target remote"}}